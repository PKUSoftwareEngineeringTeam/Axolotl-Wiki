<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> 博客文件结构 </title>
    <link rel="stylesheet" href="/style_official.css" />
</head> 
<head>
  <link rel="stylesheet" href="/toc.css" />
</head>
<body>
  <header class="header">
    <nav class="nav container">
        <a href="/" class="nav-brand">
            <span class="axolotl-gradient"> Axolotl Wiki </span>
        </a>

        <ul class="nav-menu">
            <li><a href="/" class="nav-link">首页</a></li>
            <li><a href="/blog.html" class="nav-link">博客</a></li>
            <li><a href="/about.html" class="nav-link">关于</a></li>
            <li><a href="/contact.html" class="nav-link">联系</a></li>
        </ul>

        
    </nav>
</header> 

  <main class="main">
    <div class="container">
      <article class="article fade-in">
        <header class="article-header">
 
          <h1 class="article-title"> 博客文件结构 </h1>
 

 
        </header>

        <div class="article-content">
 <p>你的博客目录结构如下所示：</p>
<pre><code>.
├── allay.toml      # 博客的配置文件，通常来自你使用的主题
├── content         # 你的 Markdown 文件存放于此
├── public          # 生成的静态文件将被放置在这里
├── shortcodes      # 可在此定义自定义短代码
├── static          # 可直接访问的静态文件
└── themes          # 主题目录
</code></pre>
<ul>
<li><code>static/</code>：该目录包含静态文件，如图片和 PDF 文件。这些文件会在构建过程中直接复制到 <code>public/</code> 目录，并可通过 URL 直接访问。</li>
<li><code>content/</code>：该目录存放你的 Markdown 文件，每个 Markdown 文件代表博客中的一个页面。关于如何创建和组织 Markdown 文件，详见 <a href="../custom-contents/create-pages.md">创建页面</a>。</li>
<li><code>public/</code>：构建博客后，生成的静态文件会放在此目录。你可以将该目录内容部署到你的 Web 服务器。</li>
<li><code>shortcodes/</code>：用于存放你自定义的短代码，可在 Markdown 文件中使用。关于短代码的创建和使用，详见 <a href="../extra-functions/shortcode.md">短代码</a>。</li>
<li><code>themes/</code>：该目录包含博客的主题。你可以为每个主题创建子目录，每个主题可拥有自己的模板和静态文件。关于主题的自定义，详见 <a href="../themes/index.md">主题</a>。</li>
<li><code>allay.toml</code>：博客的主配置文件。你可以在此设置站点标题、基础 URL 和主题等参数。更多详情见 <a href="../configuration/index.md">配置</a>。</li>
</ul>
 
        </div>
      </article>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
        <span>© Axolotl Wiki </span>
        <span>由 Allay & Axolotl 主题驱动</span>
    </div>
</footer>

<script src="/script.js"></script> 
  <script src="/toc.js"></script>
</body>

<script>
    /**
 * A client for live reloading web pages based on file changes.
 * It periodically polls the server to check for any modifications in the files,
 * and if changes are detected, it reloads the page after showing a notification
 * about which files have been changed.
 */
class LiveReloadClient {
    constructor() {
        this.pollingInterval = 50; // 50 ms
        this.lastTimestamps = new Map();
        this.init().then();
    }

    async init() {
        console.log('Live reload client initialized');
        await this.fetchInitialTimestamps();
        this.startPolling();
    }

    /**
     * Fetches the initial timestamps for files and stores them.
     * This method sends a request to the server to get the last modified timestamps of files,
     * then updates the `lastTimestamps` with the received data.
     */
    async fetchInitialTimestamps() {
        try {
            const response = await fetch('/api/last-modified');
            const timestamps = await response.json();

            for (const [file, timestamp] of Object.entries(timestamps)) {
                this.lastTimestamps.set(file, timestamp);
            }

            console.log('Initial file timestamps loaded');
        } catch (error) {
            console.error('Failed to fetch initial timestamps:', error);
        }
    }

    startPolling() {
        setInterval(async () => {
            await this.checkForChanges();
        }, this.pollingInterval);
    }

    /**
     * Asynchronously checks for changes in the files by comparing the last modified timestamps.
     * If any file has been modified or deleted, it logs the changes, shows a reload notification,
     * and reloads the page after a short delay.
     */
    async checkForChanges() {
        try {
            const response = await fetch('/api/last-modified');
            const currentTimestamps = await response.json();

            let shouldReload = false;
            let changedFiles = [];

            for (const [file, timestamp] of Object.entries(currentTimestamps)) {
                const lastTimestamp = this.lastTimestamps.get(file);

                if (!lastTimestamp || lastTimestamp < timestamp) {
                    shouldReload = true;
                    changedFiles.push(file);
                    this.lastTimestamps.set(file, timestamp);
                }
            }

            for (const file of this.lastTimestamps.keys()) {
                if (!currentTimestamps[file]) {
                    shouldReload = true;
                    changedFiles.push(`${file} (deleted)`);
                    this.lastTimestamps.delete(file);
                }
            }

            if (shouldReload) {
                console.log('Files changed, reloading page:', changedFiles);
                window.location.reload();
            }
        } catch (error) {
            console.error('Error checking for changes:', error);
        }
    }
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        new LiveReloadClient();
    });
} else {
    new LiveReloadClient();
}
</script>

</html>